<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Subject Quiz</title>
  <style>
    :root {
      --bg-color: #f9f9f9;
      --container-bg: #ffffff;
      --text-color: #111;
      --button-bg: #eeeeee;
      --button-hover-bg: #dddddd;
      --border-color: #ccc;
    }
    body {
      margin: 10px;
      padding: 8px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
    }
    /* Dark mode */
    body.dark-mode {
      --bg-color: #121212;
      --container-bg: #1e1e1e;
      --text-color: #f1f1f1;
      --button-bg: #2e2e2e;
      --button-hover-bg: #3a3a3a;
      --border-color: #555;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
      background-color: var(--container-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease;
    }
    .subject-container {
      text-align: center;
      margin: 0 0 30px;
      border: 2px solid brown;
      box-shadow: 3px 4px 14px black;
      padding: 7px;
    }
    .subject-title {
      font-size: 1.6em;
      font-weight: bold;
      background-color: brown;
      color: white;
      text-align: center;
      padding: 12px 20px;
      margin: 0 0 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    .option {
      flex: 1 1 calc(50% - 10px);
      min-height: 60px;
      background-color: var(--button-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1em;
      text-align: center;
      padding: 15px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .option:hover { background-color: var(--button-hover-bg); }
    button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; margin-top: 12px; transition: background-color 0.3s ease; }
    button.set-start { background-color: #ffa500; color: white; }
    button.set-start:hover { background-color: #cc8400; }
    button.reset { background-color: #ff4d4d; color: white; }
    button.reset:hover { background-color: #d93636; }
    button.undo { background-color: #4CAF50; color: white; }
    button.undo:hover { background-color: #3e9e44; }
    button.redo { background-color: #2196F3; color: white; }
    button.redo:hover { background-color: #1c85d0; }
    button.dark-mode-toggle { background-color: #444; color: white; }
    button.dark-mode-toggle:hover { background-color: #222; }
    .input-group { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
    .input-group input { flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background-color: white; color: black; }
    .answers-list { margin-top: 20px; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--container-bg); max-height: 300px; overflow-y: auto; }
    .answers-list div { margin: 8px 0; padding: 10px; border: 1px solid black; border-radius: 8px; background-color: white; text-align: center; font-weight: bold; box-shadow: 1px 0px 8px rgba(0,0,0,0.1); transition: background-color 0.2s; }
    .answers-list div:hover { background-color: yellow; color: blue; border: 2px solid black; }
    .tick { color: green; font-size: 1.3em; margin-left: 10px; }
    .cross { color: red; font-size: 1.3em; margin-left: 10px; }
    .average-time { margin-top: 15px; font-weight: bold; text-align: center; font-size: 1.1em; }
    @media (max-width: 600px) {
      .container { margin: 15px; padding: 15px; }
      .options { gap: 10px; }
      .option { flex: 1 1 100%; font-size: 1.1em; }
      .input-group { flex-direction: column; }
      button { font-size: 0.95em; padding: 10px; }
      .answers-list { font-size: 14px; }
    }
  </style>
</head>
<body>
  <button onclick="toggleDarkMode()" id="dark-mode-toggle" style="margin: 10px;">RESET ALL DATA</button>
  <div id="main-container"></div>
  <div style="text-align: center; margin-top: 20px;">
    <input type="text" id="new-subject-name" placeholder="Enter subject name">
    <button onclick="addSubjectWindow()">Add Subject</button>
  </div>
  <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
  <script>
    const subjects = {};
    function addSubjectWindow() {
      const subjectName = document.getElementById('new-subject-name').value.trim();
      if (!subjectName) return alert("Please enter a subject name.");
      if (subjects[subjectName]) return alert("This subject already exists.");
      const container = document.createElement('div');
      container.className = 'subject-container';
      container.id = `container-${subjectName}`;
      container.innerHTML = `
        <div class="subject-title">${subjectName}</div>
        <div class="input-group">
          <input type="number" placeholder="Start Q#" id="start-${subjectName}">
          <button class="set-start" onclick="setStartQuestion('${subjectName}')">Set Start Question</button>
        </div>
        <div class="options" id="options-${subjectName}"></div>
        <div class="buttons">
          <button class="undo" onclick="undo('${subjectName}')">Undo</button>
          <button class="redo" onclick="redo('${subjectName}')">Redo</button>
        </div>
        <div class="answers-list" id="answers-${subjectName}"></div>
        <div class="average-time" id="avg-${subjectName}"></div>
        <button class="reset" onclick="resetQuiz('${subjectName}')">Reset Quiz</button>
      `;
      document.getElementById('main-container').appendChild(container);
      subjects[subjectName] = { currentQuestionNumber: 1, answers: {}, history: [], future: [], startTime: Date.now(), localKey: `quizAnswers_${subjectName}` };
      const saved = JSON.parse(localStorage.getItem(subjects[subjectName].localKey));
      if (saved) { subjects[subjectName].answers = saved; subjects[subjectName].currentQuestionNumber = Object.keys(saved).length + 1; }
      updateOptions(subjectName);
      updateAnswersList(subjectName);
    }
    function saveOption(subjectName, option) {
      const subject = subjects[subjectName];
      const endTime = Date.now();
      const timeTakenSec = (endTime - subject.startTime) / 1000;
      const min = Math.floor(timeTakenSec/60), sec = Math.floor(timeTakenSec%60);
      const formatted = `${min}:${sec<10?'0':''}${sec}`;
      subject.startTime = endTime;
      if (subject.answers[subject.currentQuestionNumber]) subject.history.push({question: subject.currentQuestionNumber, answer: subject.answers[subject.currentQuestionNumber]});
      subject.future = [];
      subject.answers[subject.currentQuestionNumber] = {option, time: formatted, raw: timeTakenSec};
      subject.currentQuestionNumber++;
      localStorage.setItem(subject.localKey, JSON.stringify(subject.answers));
      updateOptions(subjectName);
      updateAnswersList(subjectName);
    }
    function skipQuestion(subjectName) {
      saveOption(subjectName, 'skipped');
    }
    function updateOptions(subjectName) {
      const container = document.getElementById(`options-${subjectName}`);
      container.innerHTML = "";
      const qNum = subjects[subjectName].currentQuestionNumber;
      for (let i=0; i<4; i++) {
        const letter = String.fromCharCode(97+i);
        const btn = document.createElement('button');
        btn.className = 'option'; btn.textContent = `${qNum}.${letter.toUpperCase()}`;
        btn.onclick = () => saveOption(subjectName, letter);
        container.appendChild(btn);
      }
      const skipBtn = document.createElement('button');
      skipBtn.textContent = '⏭️ Skip'; skipBtn.style.fontSize = '0.8em'; skipBtn.style.padding = '5px 10px'; skipBtn.style.background='#ccc'; skipBtn.style.borderRadius='6px'; skipBtn.style.marginTop='10px';
      skipBtn.onclick = () => skipQuestion(subjectName);
      container.appendChild(skipBtn);
    }
    function updateAnswersList(subjectName) {
      const subject = subjects[subjectName];
      const container = document.getElementById(`answers-${subjectName}`);
      const avgContainer = document.getElementById(`avg-${subjectName}`);
      container.innerHTML = "";
      let totalTime=0, count=0;
      for (let q in subject.answers) {
        const data = subject.answers[q]; totalTime += parseFloat(data.raw); count++;
        const item = document.createElement('div');
        item.textContent = `Que. ${q}: __${data.option} (Time: ${data.time})`;
        if (data.raw > 240) item.style.backgroundColor = '#f8d7da';
        container.appendChild(item);
        const hammer = new Hammer(item);
        hammer.on('swipeleft', ()=>item.innerHTML += ' <span class="cross">❌</span>');
        hammer.on('swiperight', ()=>item.innerHTML += ' <span class="tick">✔️</span>');
      }
      if (count>0) {
        const avg = totalTime/count;
        const min = Math.floor(avg/60), sec = Math.floor(avg%60);
        avgContainer.textContent = `Average Time: ${min}:${sec<10?'0':''}${sec}`;
      } else avgContainer.textContent = "";
    }
    function setStartQuestion(subjectName) {
      const val = parseInt(document.getElementById(`start-${subjectName}`).value);
      if (val>0) { subjects[subjectName].currentQuestionNumber=val; updateOptions(subjectName); updateAnswersList(subjectName); }
      else alert("Invalid question number.");
    }
    function undo(subjectName) {
      const subj = subjects[subjectName];
      if (subj.currentQuestionNumber>1) {
        const lastQ = subj.currentQuestionNumber-1;
        if (subj.answers[lastQ]) {
          subj.history.push({question: lastQ, answer: subj.answers[lastQ]});
          delete subj.answers[lastQ]; subj.currentQuestionNumber--;
          localStorage.setItem(subj.localKey, JSON.stringify(subj.answers));
          const undone = subj.history.pop(); subj.future.push(undone);
          updateOptions(subjectName); updateAnswersList(subjectName);
        }
      }
    }
    function redo(subjectName) {
      const subj = subjects[subjectName];
      if (subj.future.length>0) {
        const action = subj.future.pop();
        subj.answers[action.question]=action.answer;
        subj.currentQuestionNumber = action.question+1;
        localStorage.setItem(subj.localKey, JSON.stringify(subj.answers));
        updateOptions(subjectName); updateAnswersList(subjectName);
      }
    }
    function resetQuiz(subjectName) {
      if (confirm(`Reset all data for ${subjectName}?`)) {
        const subj = subjects[subjectName];
        subj.currentQuestionNumber=1; subj.answers={}; subj.history=[]; subj.future=[]; subj.startTime=Date.now();
        localStorage.removeItem(subj.localKey);
        document.getElementById(`options-${subjectName}`).innerHTML="";
        document.getElementById(`answers-${subjectName}`).innerHTML="";
        document.getElementById(`avg-${subjectName}`).innerHTML="";
        updateOptions(subjectName); updateAnswersList(subjectName);
      }
    }
    window.onload = function() {
      for (let key in localStorage) {
        if (key.startsWith('quizAnswers_')) {
          document.getElementById('new-subject-name').value = key.replace('quizAnswers_','');
          addSubjectWindow();
        }
      }
    };
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      document.querySelectorAll('.container, .option, .answers-list div, input, button').forEach(el=>el.classList.toggle('dark-mode'));
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }
    window.addEventListener('DOMContentLoaded', ()=>{
      if (localStorage.getItem('darkMode')==='true') toggleDarkMode();
    });
  </script>
</body>
</html>

